<%@ page language="java" contentType="text/html;charset=UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>


<html>

<script type='text/javascript' src='<c:url value="/resources/js/jquery-1.6.4.min.js"/>'></script>
<script type='text/javascript' src='<c:url value="/resources/js/jquery-ui-1.10.3.custom.js"/>'></script>
<script type='text/javascript' src='<c:url value="/resources/js/grid.locale-es.js"/>'></script>
<script type='text/javascript' src='<c:url value="/resources/js/jquery.jqGrid.min.js"/>'></script>
<script type='text/javascript' src='<c:url value="/resources/js/noty/jquery.noty.js"/>'></script>
<script type='text/javascript' src='<c:url value="/resources/js/noty/layouts/top.js"/>'></script>
<script type='text/javascript' src='<c:url value="/resources/js/noty/themes/default.js"/>'></script>
<head>

<link rel="stylesheet" type="text/css" media="screen" href="<c:url value="/resources/css/cupertino/jquery-ui-1.10.3.custom.css" context="/teammanagement"/>">  
<link rel="stylesheet" type="text/css" media="screen" href="<c:url value="/resources/css/ui.jqgrid.css" context="/teammanagement"/>">  					
<link rel="stylesheet" type="text/css" media="all" href="<c:url value="/resources/css/styles.css" context="/teammanagement"/>">  
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">



<title>Partidos de ${matchForm.equipo.nombre}</title>
 <script type="text/javascript">
     var jq = jQuery.noConflict();
 </script>

<script type="text/javascript">




function getDateFromJSonDate(jsondate){
	var fecha="";	
	if (jsondate!=null){
	
		fecha= new Date(jsondate);
		fecha= fecha.getDate()+"/"+(fecha.getMonth()+1)+"/"+fecha.getFullYear();
		
	}
	return fecha;
}



  
 jq(function() {

  var idEquipo = ${matchForm.equipo.idEquipo};

  jq("#grid").jqGrid({
  

   onSelectRow: function(id){

     var sel_id = jq("#grid").jqGrid('getGridParam', 'selrow');
     var isPlayedGame = jq("#grid").jqGrid('getCell', sel_id, 'revisado');
     var idActaPartido = jq("#grid").jqGrid('getCell', sel_id, 'idActaPartido');     
     var idEquipoLocal = jq("#grid").jqGrid('getCell', sel_id, 'idEquipoLocal');
     var idEquipoVisitante = jq("#grid").jqGrid('getCell', sel_id, 'idEquipoVisitante');
     var nombreLocal = jq("#grid").jqGrid('getCell', sel_id, 'equipoLocal');
     var nombreVisitante = jq("#grid").jqGrid('getCell', sel_id, 'equipoVisitante');

	if (isPlayedGame == 'true'){
		
		jq("#localStats").jqGrid('setCaption', nombreLocal);
		jq("#visitorStats").jqGrid('setCaption', nombreVisitante);

		jq("#localStats").jqGrid('setGridParam',{url:'/teammanagement/games/list/'+idActaPartido+'/'+idEquipoLocal}).trigger('reloadGrid');		
		jq("#visitorStats").jqGrid('setGridParam',{url:'/teammanagement/games/list/'+idActaPartido+'/'+idEquipoVisitante}).trigger('reloadGrid'); 
		jq("#localStats").jqGrid('setGridState', 'visible');
		jq("#visitorStats").jqGrid('setGridState', 'visible');
		
	}
	else {
		jq("#localStats").jqGrid('setGridState', 'hidden');
		jq("#visitorStats").jqGrid('setGridState', 'hidden');
		}
	},

   url:'/teammanagement/games/list/'+idEquipo,
   datatype: 'json',
   mtype: 'GET',
      colNames:['Id', 'idActaPartido', 'idEquipoLocal', 'Local', '' , '' , 'idEquipoVisitante', 'Visitante' ,'Fecha','Temporada','Revisado'],
      colModel:[
	{name:'idPartido',index:'idPartido', width:6,editable:false,editoptions:{readonly:true,size:10},hidden:true},
	{name:'idActaPartido',index:'idActaPartido', width:6,editable:false,editoptions:{readonly:true,size:10},hidden:true},
	{name:'idEquipoLocal',index:'idEquipoLocal', width:6,editable:false,editoptions:{readonly:true,size:10},hidden:true},
	{name:'equipoLocal',index:'equipoLocal', width:20,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sortable:true},
	{name:'resultadoLocal',index:'actaPartido.resultadoLocal', width:5,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center',sortable:true},
	{name:'resultadoVisitante',index:'actaPartido.resultadoVisitante', width:5,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center',sortable:true},
	{name:'idEquipoVisitante',index:'idEquipoVisitante', width:6,editable:false, sortable:false, editoptions:{readonly:true,size:10},hidden:true},
	{name:'equipoVisitante',index:'equipoVisitante', width:20,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center',sortable:true},
	{name:'fecha',index:'fecha', width:10,editable:true, editrules:{required:true}, editoptions:{size:10}, sorttype:'date', align:'center', formatter: getDateFromJSonDate, sortable:true },
	{name:'temporada',index:'temporada.idTemporada', width:10,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sortable:true},
	{name:'revisado',index:'revisado', width:4,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sortable:false, hidden:true}
	

      ],
      postData: {
   },
   rowNum:20,
      rowList:[20,40,60],
      height: 300,
      altRows: true,
      autowidth: true,
   rownumbers: true,
      pager: '#pager',
      sortname: 'fecha',
      viewrecords: true,
      sortorder: "asc",
      caption:"Partidos",
      emptyrecords: "Empty records",
      loadonce: false,
      loadComplete: function() {
 
	jq("#localStats").jqGrid('setGridState', 'hidden');
	jq("#visitorStats").jqGrid('setGridState', 'hidden');

   },
      jsonReader : {
          root: "rows",
          page: "page",
          total: "total",
          records: "records",
          repeatitems: false,
          cell: "cell",
          id: "id"
      }
  });




  jq("#localStats").jqGrid({


  
   url:'',
   datatype: 'json',
   mtype: 'GET',
      colNames:['idEstadistica' , 'Jugador',  'Pts','Reb','Asist','Minutos'],
      colModel:[
	{name:'idEstadistica',index:'idEstadistica', width:6,editable:false,editoptions:{readonly:true,size:10},hidden:true},
	{name:'nombreJugador',index:'jugador.nombre', width:30,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sortable:true},
	{name:'puntos',index:'puntos', width:6,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sorttype:'int', sortable:true},
	{name:'rebotes',index:'rebotes', width:6,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sorttype:'int', sortable:true},
	{name:'asistencias',index:'asistencias', width:6,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sorttype:'int', sortable:true},
	{name:'minutos',index:'minutos', width:6,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sorttype:'int', sortable:true}
	

      ],
      postData: {
   },
      sortable: true,
      rowNum:20,
      rowList:[20,40,60],
      height: 300,
      width: 500,
      altRows: true,
      autowidth: true,

   rownumbers: true,
      sortname: 'puntos',
      viewrecords: true,
      sortorder: "desc",
      caption:"Local",
      emptyrecords: "Empty records",
      loadComplete: function() {
	
   },
      jsonReader : {
          root: "rows",
          page: "page",
          total: "total",
          records: "records",
          repeatitems: false,
          cell: "cell",
          id: "id"
      }
  });

  jq("#visitorStats").jqGrid({


  
   url:'',
   datatype: 'json',
   mtype: 'GET',
      colNames:['idEstadistica' , 'Jugador',  'Pts','Reb','Asist','Minutos'],
      colModel:[
	{name:'idEstadistica',index:'idEstadistica', width:6,editable:false,editoptions:{readonly:true,size:10},hidden:true},
	{name:'nombreJugador',index:'jugador.nombre', width:30,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center'},
	{name:'puntos',index:'puntos', width:6,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sorttype:'int'},
	{name:'rebotes',index:'rebotes', width:6,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sorttype:'int'},
	{name:'asistencias',index:'asistencias', width:6,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sorttype:'int'},
	{name:'minutos',index:'minutos', width:6,editable:true, editrules:{required:true}, editoptions:{size:10}, align:'center', sorttype:'int'}	

      ],
      postData: {
   },
      sortable: true,
      rowNum:20,
      rowList:[20,40,60],
      height: 300,
      width: 500,
      altRows: true,
      autowidth: true,

   rownumbers: true,
      sortname: 'puntos',
      viewrecords: true,
      sortorder: "desc",
      caption:"Visitante",
      emptyrecords: "Empty records",
      loadComplete: function() {
	
   },
      jsonReader : {
          root: "rows",
          page: "page",
          total: "total",
          records: "records",
          repeatitems: false,
          cell: "cell",
          id: "id"
      }
  });

 
 });

</script>



<jsp:include page="menucompetition.jsp" />


</head>


<body>

<sec:authorize access="isAuthenticated()">


<div id="jqgrid">
	<table id="grid"></table>
	<div id="pager"></div>
	<br>
<table>
	<tr>
	<td width="500"><table id="localStats"></table></td><td width="500"><table id="visitorStats"></table></td>
	</tr>
</table>

</div>

<br/>




</sec:authorize>

<c:if test="${not empty errormessage}">
<div class="errormessage">
<ul>
<li>${errormessage}</li>
</ul>
</div>
</c:if>


</body>




</html>

